<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Owner Login</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="bg-gradient">
<div class="auth-container">
    <div class="auth-card">
        <h2>Owner Login</h2>
        <p class="subtitle">Sign in to manage your apps and view insights.</p>

        <form id="loginForm" class="auth-form">
            <div class="form-group">
                <label for="email">Email address</label>
                <input type="email" id="email" placeholder="owner@example.com" required>
            </div>

            <div class="form-group">
                <label for="password">Password</label>
                <input type="password" id="password" placeholder="Enter your password" required>
            </div>

            <button type="submit" class="btn primary full-width">Login</button>
        </form>

        <p id="loginMsg" class="status-text"></p>

        <p class="switch-link">
            New owner?
            <a th:href="@{/owner/register}">Create an account</a>
        </p>

        <a th:href="@{/}" class="back-link">‚Üê Back to Owner Home</a>
    </div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const owner = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value
    };

    const msg = document.getElementById('loginMsg');
    msg.textContent = 'Signing you in...';
    msg.className = 'status-text';

    try {
        const res = await fetch('/api/owners/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(owner)
        });

        if (!res.ok) {
            const text = await res.text();
            msg.textContent = text || 'Login failed. Please check your details.';
            msg.classList.add('error');
            return;
        }

        
        const data = await res.json();

        
        localStorage.setItem('ownerJwt', data.token);
        localStorage.setItem('ownerId', data.ownerId);
        window.location.href = '/owner/dashboard';
        
        msg.textContent = 'Login successful. Redirecting...';
        msg.classList.add('success');

    } catch (err) {
        msg.textContent = 'Login failed. Please try again.';
        msg.classList.add('error');
    }
});
</script>
</body>
</html>
