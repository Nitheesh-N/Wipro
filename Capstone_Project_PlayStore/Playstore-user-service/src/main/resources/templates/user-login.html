<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Login – PlayStore</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
</head>
<body class="bg-gradient">
<div class="auth-wrapper">
    <div class="auth-card">
        <div class="auth-header">
            <h2>Welcome back</h2>
            <p>Login to continue discovering and reviewing apps.</p>
        </div>

        <form id="loginForm" class="auth-form">
            <div class="form-group">
                <label for="email">Email address</label>
                <input id="email" type="email" placeholder="you@example.com" required>
            </div>
            <div class="form-group">
                <label for="password">Password</label>
                <input id="password" type="password" placeholder="Enter your password" required>
            </div>

            <button type="submit" class="btn primary full-width">Login</button>
        </form>

        <p id="loginMsg" class="status"></p>

        <p class="switch">
            New to PlayStore?
            <a th:href="@{/user/register}">Create an account</a>
        </p>

        <a th:href="@{/}" class="back-link">← Back to home</a>
    </div>
</div>

<script>
document.getElementById('loginForm').addEventListener('submit', async (e) => {
    e.preventDefault();

    const user = {
        email: document.getElementById('email').value,
        password: document.getElementById('password').value
    };

    const msg = document.getElementById('loginMsg');
    msg.textContent = 'Signing you in...';
    msg.className = 'status';

    try {
        const res = await fetch('/api/users/login', {
            method: 'POST',
            headers: {'Content-Type': 'application/json'},
            body: JSON.stringify(user)
        });

        if (!res.ok) {
            const text = await res.text();
            msg.textContent = text || 'Invalid email or password';
            msg.classList.add('error');
            return;
        }

        
        const body = await res.json();

        localStorage.setItem('userJwt', body.token);
        localStorage.setItem('userId', body.userId);

        msg.textContent = 'Login successful. Redirecting...';
        msg.classList.add('success');

        window.location.href = '/user/dashboard';
    } catch (err) {
        msg.textContent = 'Login failed. Please try again.';
        msg.classList.add('error');
    }
});
</script>

</body>
</html>
